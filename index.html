<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulateur – Projet 2026 (% unique)</title>
  <meta name="description" content="Simulateur de contribution 2026 (taux unique) – Gîtes de France" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <style>
    .card { border: 1px solid #e2e8f0; border-radius: 1rem; background: white; }
    .btn { border-radius: 0.75rem; padding: 0.6rem 0.9rem; border: 1px solid #e2e8f0; background: white; }
    .btn:hover { background: #f7fafc; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-emerald-50 via-white to-sky-50">
  <div id="root" class="p-6 md:p-10">Chargement…</div>

  <script type="text/javascript">
    const DEPT_CODES = ["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","2A","2B","971","972","973","974","976"];

    const { useState, useMemo, useEffect } = React;
    const DEFAULT_RATE = 0.02;
    const fmt = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 });
    const fmtPrecise = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' });

    function App(){
      const [dept, setDept] = useState('');
      const [loyerStr, setLoyerStr] = useState('');
      const [rate, setRate] = useState(DEFAULT_RATE);
      const [displayed, setDisplayed] = useState(0);

      const loyer = useMemo(() => {
        const raw = (loyerStr || '').replace(/\\s/g, '').replace(/,/, '.');
        const val = Number(raw);
        return Number.isFinite(val) ? Math.max(0, val) : 0;
      }, [loyerStr]);

      const result = useMemo(() => loyer * rate, [loyer, rate]);

      useEffect(() => {
        const start = displayed;
        const end = result;
        const duration = 450;
        const startTs = performance.now();
        let raf;
        const tick = (t) => {
          const p = Math.min(1, (t - startTs) / duration);
          const eased = 1 - Math.pow(1 - p, 4);
          setDisplayed(start + (end - start) * eased);
          if (p < 1) raf = requestAnimationFrame(tick);
        };
        raf = requestAnimationFrame(tick);
        return () => cancelAnimationFrame(raf);
      }, [result]);

      const valid = dept.trim().length > 0 && loyer > 0;

      return React.createElement('div', {className:'mx-auto max-w-5xl'}, [
        React.createElement('h1',{key:'h',className:'text-3xl md:text-4xl font-semibold text-slate-800'},'Simulateur « Projet 2026 – % unique »'),
        React.createElement('p',{key:'p',className:'mt-2 text-slate-600'},'Indiquez votre code département et votre loyer propriétaire 2025 (HT).'),
        React.createElement('div',{key:'form',className:'mt-6 card p-6'},[
          React.createElement('input',{key:'dept',placeholder:'Code département',value:dept,onChange:(e)=>setDept(e.target.value),className:'border rounded px-2 py-1 mr-2'}),
          React.createElement('input',{key:'loyer',placeholder:'Loyer 2025 (HT)',value:loyerStr,onChange:(e)=>setLoyerStr(e.target.value),className:'border rounded px-2 py-1 mr-2'}),
          valid && React.createElement('div',{key:'res',className:'mt-4'},[
            React.createElement('div',{className:'text-lg font-semibold'}, fmt.format(Math.round(displayed))),
            React.createElement('div',{className:'text-sm text-gray-600'}, `Calcul : ${fmtPrecise.format(loyer)} × ${(rate*100).toFixed(2)}%`)
          ])
        ])
      ]);
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
